<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="generator" content="http://www.nongnu.org/elyxer/"/>
<meta name="create-date" content="2014-04-06"/>
<link rel="stylesheet" href="http://elyxer.nongnu.org/lyx.css" type="text/css" media="all"/>
<title>Arduino  Library</title>
</head>
<body>
<div id="globalWrapper">
<h1 class="title">
Arduino <b>errorhandling</b> Library
</h1>
<h2 class="author">
Garrett Berg, Cloudform Design, garrett@cloudformdesign.com
</h2>
<div class="Standard">
<b>LICENSE: </b>This library is released under the FreeBSD License, if you need a copy go to:<a class="URL" href=" http://www.freebsd.org/copyright/freebsd-license.html"> http://www.freebsd.org/copyright/freebsd-license.html</a>
</div>
<div class="Standard">
<b>Copyright: </b>Garrett Berg <a class="URL" href="cloudformdesign.com">cloudformdesign.com</a>, <a class="URL" href="garrett@cloudformdesign.com">garrett@cloudformdesign.com</a>
</div>
<div class="Standard">
Loosly based on code from the fantastic "<i>Learn C the Hard Way</i>", Zed A. Shaw, <a class="URL" href="http://c.learncodethehardway.org/book/ex20.html">http://c.learncodethehardway.org/book/ex20.html</a>
</div>
<h1 class="Section-">
<a class="toc" name="toc-Section--1"></a>Summary
</h1>
<div class="Standard">
This is the Arduino errorhandling library, meant to make debugging and error handling be simple and work together.
</div>
<h2 class="Subsection-">
<a class="toc" name="toc-Subsection--1"></a>Intended Use
</h2>
<div class="Standard">
There are many times where you want to do error checking and simultaneously provide debugging. This library helps significantly. Errors are automatically printed if DEBUG is defined.
</div>
<div class="Standard">
This library offers two ways to deal with errors,:
</div>
<ol>
<li>
<b>return checks</b> — these do all your logging for you and set <b>errno</b> (the global error variable). They then return R. These are intended for "simple use" cases, where you do not need to do any error handling (like send special error messages, close ports, etc)
</li>
<li>
<b>goto error checks</b> — these do your logging, etc and then "<i>goto error</i>" where you can do error handling like closing ports, etc. 
</li>

</ol>
<div class="Standard">
In the the calling functions, you can then noerr_log_return() to follow the stack trace down so you can see what called what. This helps you keep track of where your code is giving errors. For example, in &ldquo;errorhandling_ex1&rdquo; if you type ’x’ (an invalid input), you will get:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">Input Int: 
:: [DBG]:M:1383(0 errorhandling_ex1.ino:37)|78 0 
:: [ERR](50 errorhandling_ex1.ino:25)|(50:TypeErr)120
:: [DBG]:M:1383(50 errorhandling_ex1.ino:39)|outint:-1 
:: [ERR](50 errorhandling_ex1.ino:40)|(254:NoNewErr) 
:: [ERR](50 errorhandling_ex1.ino:49)|(254:NoNewErr) 
:: [DBG]:M:1444(50 errorhandling_ex1.ino:54)|Caught Error 
:: [ERR](253 errorhandling_ex1.ino:55)|(253:ClredErr) 
</pre>
</div>

</div>
<h1 class="Section-">
<a class="toc" name="toc-Section--2"></a>Preprossessor Definitions
</h1>
<div class="Standard">
You can define the following definitions to affect the behavior of this module
</div>
<div class="Standard">
<b>#define DEBUG</b>
</div>
<ul>
<li>
define DEBUG or LOGLEVEL before importing this module to print things, otherwise error checking, etc will be silent.
</li>
<li>
if DEBUG is defined and LOGLEVEL is not, LOGLEVEL == 50
</li>

</ul>
<div class="Standard">
<b>#define LOGLEVEL</b>
</div>
<ul>
<li>
LOGLEVEL can be defined as various values up to 50.<ul>
<li>
&gt;= 50 — all messages printed (debug, info, error)
</li>
<li>
&lt; 50 — debug not printed (just info and error)
</li>
<li>
&lt; 40 — info not printed (just error)
</li>
<li>
&lt; 30 — nothing is printed
</li>

</ul>

</li>
<li>
loglevel can also be changed while code is running with <b>set_loglevel(uint8_t)</b>. However, definning LOGLEVEL takes less programming space.
</li>

</ul>
<h2 class="Subsection-">
<a class="toc" name="toc-Subsection--2"></a>Alternate Serial Ports:
</h2>
<div class="Standard">
You can use a different serial port from the hardware one, through the SoftwareSerial
</div>
<div class="Standard">
library. Simple initilize your SoftwareSerial class and pass it to EH_config.
</div>
<div class="Standard">
<b>Example:</b>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">mysoft = SoftwareSerial(10, 11); RX, TX
void setup(){
  mysoft.begin(57600); //57600 is the recommended speed because the library can delay other code
  EH_config(mysoft);
  //... rest of your code
}
</pre>
</div>

</div>
<h2 class="Subsection-">
<a class="toc" name="toc-Subsection--3"></a>Global Variables:
</h2>
<div class="Labeling">
<b>errno</b> :: specifies error type. String format is automatically printed with log_err()
</div>
<div class="Labeling">
<b>derr</b> :: main error. This is what specifies that an error occured (non-zero == error)
</div>
<h1 class="Section-">
<a class="toc" name="toc-Section--3"></a>Macro Overview:
</h1>
<div class="Standard">
<b>Logging functions:</b>
</div>
<ul>
<li>
<b>debug(...) ::</b><ul>
<li>
prints out: [DBG](derr file:line)|...
</li>

</ul>

</li>
<li>
<b>log_info(...) ::</b><ul>
<li>
prints out: [INFO](derr file:line)|...
</li>

</ul>

</li>
<li>
<b>log_err(...) ::</b><ul>
<li>
prints out [ERR](derr file:line)|(strerrno:errno)|...
</li>
<li>
Note automatically called by all below functions except noerr and clrerr\
</li>

</ul>

</li>

</ul>
<div class="Standard">
<b>Error handling Functions:</b>
</div>
<div class="Standard">
<b>Definitions:</b>
</div>
<div class="Labeling">
<b>A</b> — assertion, if A is false the macro triggers
</div>
<div class="Labeling">
<b>E </b>-- Specified Error to be raised. See section on Defined Errors
</div>
<div class="Labeling">
<b>M </b>-- User message
</div>
<div class="Labeling">
<b>R </b>-- Return value. Should be left off for void functions.
</div>
<div class="Labeling">
<b>&ldquo;...&rdquo; </b>-- Same as M except can take advantage of the same functionality as Serial.println(...)
</div>
<ul>
<li>
<b>assert(A) ::</b><ul>
<li>
Assert that the value is true. If it is not true, then derr and errno = ERR_ASSERT
</li>
<li>
Also logs error with message "AS"
</li>
<li>
Note: requires "error:" defined for goto
</li>

</ul>

</li>
<li>
<b>raise(E, ...) ::</b><ul>
<li>
Raises the error <b>E </b>and logs it
</li>
<li>
Also can print a message
</li>
<li>
Note: requires "error:" defined for goto
</li>

</ul>

</li>
<li>
<b>assert_raise(A, E, ...) ::</b><ul>
<li>
if A is false, raise(E)
</li>
<li>
Also can print a message
</li>
<li>
Note: requires "error:" defined for goto
</li>

</ul>

</li>
<li>
<b>iferr_catch() ::</b><ul>
<li>
if there is an error, "goto error"
</li>
<li>
Note: requires "error:" defined for goto
</li>

</ul>

</li>
<li>
<b>iferr_log_catch() ::</b><ul>
<li>
same as above, but also logs error.OM
</li>
<li>
Note: requires "error:" defined for goto
</li>

</ul>

</li>
<li>
<b>[fun]_return(..., return_val) ::</b><ul>
<li>
The above functions have a "return" variety, where they return the return_val instead of "goto error"
</li>
<li>
They are: <ul>
<li>
<b>assert_return(A, R)</b> — note: in void functions, R should not be included (i.e. assert_return(A))
</li>
<li>
<b>raise_return(E, R)</b>
</li>
<li>
<b>assert_raise_return(A, E, R) </b>
</li>
<li>
<b>raisem_return(E, M, R)</b> — where M is a message
</li>
<li>
<b>assert_raisem_return(A, E, M, R)</b>
</li>
<li>
<b>iferr_return(R) iferr_log_return(R)</b>
</li>

</ul>

</li>

</ul>

</li>
<li>
<b>clrerr() ::</b><ul>
<li>
clears error specifiers (derr = 0; errno = 0
</li>

</ul>

</li>
<li>
<b>clrerr_log() ::</b><ul>
<li>
clears error specifiers and logs that it did so
</li>

</ul>

</li>
<li>
TRY(stuff) ::<ul>
<li>
silences error printing if you are expecting an error.
</li>

</ul>

</li>
<li>
CATCH_ALL ::<ul>
<li>
intended to be used after try. This will catch and clear all errors. For example:
</li>

</ul>

</li>

</ul>
<div class="Standard">
<div class="listing">
<pre class="listing">TRY(do_error());
CATCH_ALL{
  // Will only happen if there was an error.
  // Note that all errors are cleared.
}
</pre>
</div>

</div>
<ul>
<li>
CATCH_ERR(E) ::<ul>
<li>
Same as above, except it will catch a specific error
</li>

</ul>

</li>
<li>
CATCH_ERR_N(E) ::<ul>
<li>
Will catch all errors except E
</li>

</ul>

</li>
<li>
ELSE_CATCH_ERR(E), ELSE_CATCH_ERR_N(E) ::<ul>
<li>
Same as the above two, but used after another catch (kind of like an &ldquo;if else&rdquo;)
</li>

</ul>

</li>

</ul>
<h1 class="Section-">
<a class="toc" name="toc-Section--4"></a>Defined Errors
</h1>
<div class="Standard">
The following errors are defined by this module and will print the indicated output when they are raised.
</div>
<div class="Standard">
Note:
</div>
<div class="Labeling">
<b>ERR_NOERR </b>indicates that no error has happened. This is the error value after clrerr() is called
</div>
<div class="Labeling">
<b>ERR_NONEW </b>indicates that there are no <i>new</i> errors. <b>errno</b> is set to this value after log_err() is called (while derr is not changed). This exists to aid in debugging so you can follow the stack of errors with each call to <b>iferr_log_return()</b>
</div>
<div class="Labeling">
<b>ERR_CLEARED </b>is a special error used by clrerr_log() and is used to let the user know where an error was cleared.
</div>
<div class="Standard">
<table>
<tr>
<td align="center" valign="top">
<b>Defined</b>
</td>
<td align="center" valign="top">
<b>Value</b>
</td>
<td align="center" valign="top">
<b>log_err output</b>
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_NOERR
</td>
<td align="center" valign="top">
0
</td>
<td align="center" valign="top">
NoErr
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_TIMEOUT
</td>
<td align="center" valign="top">
2
</td>
<td align="center" valign="top">
TimeoutErr
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_COM
</td>
<td align="center" valign="top">
3
</td>
<td align="center" valign="top">
 ComErr
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_INPUT
</td>
<td align="center" valign="top">
4
</td>
<td align="center" valign="top">
InputErr
</td>

</tr>
<tr>
<td align="center" valign="top">

</td>
<td align="center" valign="top">

</td>
<td align="center" valign="top">

</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_TYPE
</td>
<td align="center" valign="top">
50
</td>
<td align="center" valign="top">
TypeErr
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_VALUE
</td>
<td align="center" valign="top">
51
</td>
<td align="center" valign="top">
ValueErr
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_ASSERT
</td>
<td align="center" valign="top">
52
</td>
<td align="center" valign="top">
AssertErr
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_INDEX
</td>
<td align="center" valign="top">
53
</td>
<td align="center" valign="top">
IndexErr
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_MEMORY
</td>
<td align="center" valign="top">
54
</td>
<td align="center" valign="top">
MemErr
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_CRITICAL
</td>
<td align="center" valign="top">
55
</td>
<td align="center" valign="top">
CRITErr
</td>

</tr>
<tr>
<td align="center" valign="top">

</td>
<td align="center" valign="top">

</td>
<td align="center" valign="top">

</td>

</tr>
<tr>
<td align="center" valign="top">

</td>
<td align="center" valign="top">

</td>
<td align="center" valign="top">

</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_CLEARED
</td>
<td align="center" valign="top">
253
</td>
<td align="center" valign="top">
"Cleared Error"
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_NONEW
</td>
<td align="center" valign="top">
254
</td>
<td align="center" valign="top">
NoNew 
</td>

</tr>
<tr>
<td align="center" valign="top">
ERR_UNKNOWN
</td>
<td align="center" valign="top">
255
</td>
<td align="center" valign="top">
UnknownErr
</td>

</tr>

</table>

</div>
<h1 class="Section-">
<a class="toc" name="toc-Section--5"></a><b>Logging Values</b>
</h1>
<div class="Standard">
The logging value can be set with either:
</div>
<ul>
<li>
#define LOGLEVEL myloglevel
</li>
<li>
set_loglevel(myloglevel)
</li>

</ul>
<div class="Standard">
The <i>#define</i> version is preferred when it can be used, as it can significantly reduce your code size.
</div>
<div class="Standard">
<b><table>
<tr>
<td align="center" valign="top">
LOGV_DEBUG
</td>
<td align="center" valign="top">
50
</td>
<td align="center" valign="top">
Everything is logged
</td>

</tr>
<tr>
<td align="center" valign="top">
LOGV_INFO
</td>
<td align="center" valign="top">
40
</td>
<td align="center" valign="top">
info and errors are logged
</td>

</tr>
<tr>
<td align="center" valign="top">
LOGV_ERROR
</td>
<td align="center" valign="top">
30
</td>
<td align="center" valign="top">
only errors are logged
</td>

</tr>
<tr>
<td align="center" valign="top">
LOGV_SILENT
</td>
<td align="center" valign="top">
0
</td>
<td align="center" valign="top">
nothing is logged
</td>

</tr>

</table>
</b>
</div>

<hr class="footer"/>
<div class="footer" id="generated-by">
Document generated by <a href="http://elyxer.nongnu.org/">eLyXer 1.2.3 (2011-08-31)</a> on <span class="create-date">2014-04-06T16:29:52.640161</span>
</div>
</div>
</body>
</html>

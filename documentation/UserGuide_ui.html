<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="generator" content="http://www.nongnu.org/elyxer/"/>
<meta name="create-date" content="2013-12-16"/>
<link rel="stylesheet" href="http://elyxer.nongnu.org/lyx.css" type="text/css" media="all"/>
<title>Converted document</title>
</head>
<body>
<div id="globalWrapper">
<h1 class="title">
<b>User Interface (ui) for the Arduino</b>
</h1>
<h2 class="author">
Garrett Berg, Cloudform Design, garrett@cloudformdesign.com
</h2>
<div class="Standard">
<b>LICENSE: </b>This library is released under the FreeBSD License, if you need a copy go to:<a class="URL" href=" http://www.freebsd.org/copyright/freebsd-license.html"> http://www.freebsd.org/copyright/freebsd-license.html</a>
</div>
<div class="Standard">
<b>Copyright: </b>Garrett Berg <a class="URL" href="cloudformdesign.com">cloudformdesign.com</a>, <a class="URL" href="garrett@cloudformdesign.com">garrett@cloudformdesign.com</a>
</div>
<h1 class="Section-">
<a class="toc" name="toc-Section--1"></a>Introduction
</h1>
<div class="Standard">
There was once upon a time when I tried to code my own user interface. It went a little something like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">void mythread(){
  static int place = 0;
  if(place) == 0){
    do something...
    place = 1;
  }
  if(place == 1)
     something else;
     place = 2;
  ... etc.
}
​
void loop(){
  mythread();
}
</pre>
</div>
This way of doing things had serious flaws, too many to go into. 
</div>
<div class="Standard">
Then I came across the protothreads library (included in this folder as <b>pt.h</b>) and everything was better... or was it.
</div>
<div class="Standard">
I still wanted to be able to actually <i>interface</i> with my functions and variables through the command terminal.
</div>
<div class="Standard">
So, to do this I wrote <b>threads.h</b> and <b>ui.h</b>. With these two libraries it is now possible to:
</div>
<ul>
<li>
Create threads easily — a thread is a function that will be called frequently, who’s status can be observed externally, and who can be killed by the implemented task manager. Threads are easy to create and much easier to maintain than doing similar things any other way.
</li>
<li>
Access variables easily : expose_variable(&ldquo;myvar&rdquo;, name) and you can access it with &ldquo;v myvar&rdquo; on the serial terminal.
</li>
<li>
Call functions: same as exposing variables.
</li>

</ul>
<h1 class="Section-">
<a class="toc" name="toc-Section--2"></a>Overview
</h1>
<div class="Standard">
Please see UserGuide_threading.h for the functions that you can call. See the example <b>threading_ex </b>for code examples.
</div>
<div class="Standard">
The best way to see the power of the threading module is to see it in action. Do the following:
</div>
<ul>
<li>
Load up <b>threading_ex</b>
</li>
<li>
Program it to your arduino
</li>
<li>
Set your baud rate = 57600 and set it to send both NR and CR characters on each enter.
</li>
<li>
Play with it!<ul>
<li>
type &ldquo;record&rdquo; to do a recording of the LED output
</li>
<li>
&ldquo;<b>kill blink&rdquo; </b>will kill the blink and &ldquo;<b>blink 1000&rdquo; </b>will start it again with a period of 1000ms (1 second)
</li>
<li>
Be sure to type <b>&ldquo;mon&rdquo; — </b>This starts the System Monitor and outputs useful information about how long each thread is taking and how much memory you have available.
</li>
<li>
&ldquo;<b>v led&rdquo; </b>Will give you the value of the led.
</li>
<li>
&ldquo;?&rdquo; will give you all the options
</li>

</ul>

</li>
<li>
Check out the code and read the documentation to see how things are working!
</li>
<li>
Check out the other documentation:<ul>
<li>
<b>UserGuide_errorhandling</b> is how you can generate error messages and do error handling. It also has logging.
</li>
<li>
<b>UserGuide_threading</b> is a useful reference on how to create your threads
</li>
<li>
<b>README_pt.txt </b>The protothread library is how you create your threads — it would be helpful to read this.
</li>

</ul>

</li>

</ul>
<h2 class="Subsection-">
<a class="toc" name="toc-Subsection--1"></a>Code Overview
</h2>
<ul>
<li>
<b>ui_setup_std(F, V, T) ::</b><ul>
<li>
Same as thread_setup(F, V, T) (see UserGuide_threading), but also sets up the User Interface for serial communication.
</li>

</ul>

</li>
<li>
<b>ui_pat_dog() ::</b><ul>
<li>
The user interface uses the watchdog timer so that if your thread times out (longer than 2 seconds) it will automatically reset AND print which function/thread it failed (very useful). If your function is going to take longer than 2 seconds, you need to call this function periodically. However, this is not recommended as it is bad policy for threading. See examples and README_pt.txt to see how to avoid this.<ul>
<li>
Note: do NOT call wdt_enable(...) — it will break the functionality that prints which thread failed. 
</li>

</ul>

</li>

</ul>

</li>
<li>
<b>call_name(&ldquo;mon&rdquo;) ::</b><ul>
<li>
Starts the system monitor from software, good thing in the setup function.
</li>

</ul>

</li>
<li>
<b>call_name(&ldquo;?&rdquo;) ::</b><ul>
<li>
Software printout of options. Good thing in the setup function.
</li>

</ul>

</li>
<li>
<b>See UserGuide_threading </b>for how to expose threads, etc.
</li>

</ul>
<h1 class="Section-">
<a class="toc" name="toc-Section--3"></a>Serial Port
</h1>
<div class="Standard">
Threading operates as simply as it possibly can. You can access either functions or variables through it’s interface. In summary:
</div>
<ul>
<li>
The following terminal commands are supported:<ul>
<li>
<b>v</b> ::VARNAME&rdquo; — Gives you the value of variable VARNAME in hex that you have exposed
</li>
<li>
<b>? :: </b>print all options for threads, variables and function calls.
</li>
<li>
<b>mon ::</b> starts the system monitor
</li>
<li>
<b>kill [process name] :: </b>kills the indicated process name
</li>
<li>
<b>(exposed thread/function) [input] :: </b>calls a thread or function that you have exposed. Sends it input
</li>

</ul>

</li>

</ul>

<hr class="footer"/>
<div class="footer" id="generated-by">
Document generated by <a href="http://elyxer.nongnu.org/">eLyXer 1.2.3 (2011-08-31)</a> on <span class="create-date">2013-12-16T12:29:37.175971</span>
</div>
</div>
</body>
</html>
